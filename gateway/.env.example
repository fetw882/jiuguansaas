## SillyTavern Gateway .env example

# Base path config (keep defaults unless you know you need to change)
PORT=3080

## Default seeded API key (stored to user/guest secrets on first use)
# Type should be one of SillyTavern secret keys, e.g.:
# - api_key_makersuite (Google AI Studio / Gemini)
# - api_key_openai (OpenAI)
# - api_key_generic (Generic OpenAI-compatible)
DEFAULT_API_KEY_TYPE=
DEFAULT_API_KEY=

## Gemini (Google AI Studio) fallback key
# Used if no per-user key is present
MAKERSUITE_API_KEY=

## OpenAI-compatible backend configuration
# If you want to use OpenAI directly, leave base empty and only set OPENAI_API_KEY
# If you use a reverse proxy or OpenAI-compatible service, set OPENAI_COMPAT_BASE
# Example: http://127.0.0.1:8000 (Upstream SillyTavern server running OpenAI proxy) or https://api.openai.com
OPENAI_COMPAT_BASE=

# OpenAI API key fallback (used when per-user secret api_key_openai is missing)
OPENAI_API_KEY=

# Optional: generic OpenAI-compatible key fallback for api_key_generic
GENERIC_API_KEY=

# Optional: fallback/gateway behavior toggles
ST_UPSTREAM_BASE=
ST_ENABLE_FALLBACK=false
ST_KILLLIST=false
ENFORCE_RIGHTS_ON_LOGIN=true

## Prompt shaping and intent handling (tune alignment)
# Strongly prioritize the latest user message
FORCE_USER_PRIORITY=true
# Include the latest user intent as an anchor in system text
INTENT_ANCHOR=true
INTENT_ANCHOR_CLAMP=160
# Add a synthetic final user turn that repeats the latest intent
HARD_INTENT_APPEND=true

# Heuristic intent rules (compatible with ST prompts)
# Math-only rule ("只回答数字/只输出") — set false to disable
INTENT_RULE_MATH=false
# Story-advance rule ("剧情推进/继续/采取行动")
INTENT_RULE_STORY=true

# Strict latest-intent mode: collapse prompts to last user only
# Set TRUE to eliminate drift (best for "用户说什么就回什么")
STRICT_LATEST_ONLY=false
# In strict mode, drop persona/world/system extras (keep only minimal guidance)
STRICT_LATEST_DROP_PERSONA=false

# Roleplay/story configuration
# Enforce roleplay reply and avoid restarts; inject persona/world info
ROLEPLAY_ENFORCER=true
ROLEPLAY_USE_CHARACTER_CARD=true
ROLEPLAY_USE_WORLD_INFO=true
# History turns (non-system), higher keeps more context
CHAT_HISTORY_TURNS=8
